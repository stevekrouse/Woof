<!DOCTYPE html>
<html style="height:100%">
<head>
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content="http://woofjs.com/create">
  <meta name="twitter:title" content="WoofJS">
  <meta name="twitter:description" content="WoofJS is a Scratch-inspired Javascript library for making games.">
  <meta name="twitter:image" content="./images/qIgC8Ae.png">

  <meta property="og:image" content="./images/qIgC8Ae.png">
  <meta property="og:title" content="WoofJS">
  <meta property="og:description" content="WoofJS is a Scratch-inspired Javascript library for making games.">

  <script src="//load.sumome.com/" data-sumo-site-id="44245233c319d8fe9fb7ce8c7ed64db9381aa56477888a10319261f655cfffe2" async="async"></script>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">



  <meta charset="utf-8">

  <title>WoofJS</title>
  <link rel="shortcut icon" type="image/png" href="./favicon.png"/>


  <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script src="https://www.gstatic.com/firebasejs/3.4.0/firebase.js"></script>
  <script src="https://www.gstatic.com/firebasejs/ui/live/0.5/firebase-ui-auth.js"></script>
  <link type="text/css" rel="stylesheet" href="https://www.gstatic.com/firebasejs/ui/live/0.5/firebase-ui-auth.css" />
  <script type="text/javascript" src="https://cdn.rawgit.com/showdownjs/showdown/984942e239c9bda522b9c5544aba72647983b3f1/dist/showdown.min.js"></script>
  <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.1.0/jquery.js"></script>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="./vendor/codemirror/codemirror.css">
  <script type="text/javascript" src="./vendor/codemirror/codemirror.js"></script>
  <script type="text/javascript" src="./vendor/codemirror/javascript.js"></script>
  <script type="text/javascript" src="./vendor/codemirror/closebrackets.js"></script>
  <script type="text/javascript" src="./vendor/codemirror/javascript-hint.js"></script>
  <script type="text/javascript" src="./vendor/codemirror/javascript-lint.js"></script>
  <script type="text/javascript" src="./vendor/codemirror/matchbrackets.js"></script>
  <script type="text/javascript" src="./vendor/codemirror/search.js"></script>
  <script type="text/javascript" src="./vendor/codemirror/searchcursor.js"></script>
  <script type="text/javascript" src="./vendor/codemirror/show-hint.js"></script>
  <script type="text/javascript" src="./vendor/codemirror/comment.js"></script>
  <script type="text/javascript" src="./vendor/codemirror/sublime.js"></script>
  <script type="text/javascript" src="./vendor/codemirror/foldcode.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.5.12/clipboard.min.js"></script>
  <link rel="stylesheet" href="./vendor/codemirror/foldgutter.css" />
  <script src="./vendor/codemirror/foldcode.js"></script>
  <script src="./vendor/codemirror/foldgutter.js"></script>
  <script src="./vendor/codemirror/brace-fold.js"></script>
  <script src="./vendor/codemirror/comment-fold.js"></script>
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <link rel="stylesheet" href="./vendor/codemirror/dialog.css">
  <link rel="stylesheet" href="./vendor/codemirror/show-hint.css">
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN" crossorigin="anonymous">
  <script src="./vendor/codemirror/dialog.js"></script>
  <link rel="stylesheet" href="./vendor/codemirror/lint.css">
  <script src="./vendor/codemirror/jshint.min.js"></script>
  <script src="./vendor/codemirror/lint.js"></script>
  <script src="./vendor/codemirror/scrollpastend.js"></script>
  <link rel="stylesheet" href="https://codemirror.net/theme/3024-day.css">
  <link rel="stylesheet" href="https://codemirror.net/theme/3024-night.css">
  <link rel="stylesheet" href="https://codemirror.net/theme/ambiance.css">
  <link rel="stylesheet" href="https://codemirror.net/theme/base16-dark.css">
  <link rel="stylesheet" href="https://codemirror.net/theme/base16-light.css">
  <link rel="stylesheet" href="https://codemirror.net/theme/blackboard.css">
  <link rel="stylesheet" href="https://codemirror.net/theme/cobalt.css">
  <link rel="stylesheet" href="https://codemirror.net/theme/eclipse.css">
  <link rel="stylesheet" href="https://codemirror.net/theme/elegant.css">
  <link rel="stylesheet" href="https://codemirror.net/theme/erlang-dark.css">
  <link rel="stylesheet" href="https://codemirror.net/theme/lesser-dark.css">
  <link rel="stylesheet" href="https://codemirror.net/theme/midnight.css">
  <link rel="stylesheet" href="https://codemirror.net/theme/monokai.css">
  <link rel="stylesheet" href="https://codemirror.net/theme/neat.css">
  <script src="https://unpkg.com/vue@2.0.1/dist/vue.js"></script>
  <script data-presets="es2015" src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.14.0/babel.min.js"></script>
  <script src="https://cdn.rawgit.com/beautify-web/js-beautify/1b52eb1f90daaefa6ff0fa7736f97fbfc58093c1/js/lib/beautify.js"></script>
  <style>

     html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
    }

    #page {
      position: relative;
      display: flex;
      flex-flow: row wrap;
      align-items: stretch;
      align-content: stretch;
      height: 100%;
    }

    body {
      background-color: #fff;
      font-family: sans-serif;
    }

    h1 {
      font-weight: normal;
      font-size: 25px;
    }

    .CodeMirror {
      font-size: 13px;
      flex: 1 0 auto;
      display: flex;
      flex-flow: column wrap;
      align-items: stretch;
      align-content: stretch;
      width: 100%;
    }

    .CodeMirror-scroll {
      display: flex;
      flex-flow: column wrap;
      align-items: stretch;
      align-content: stretch;
      flex: 1 0 auto;
      overflow: auto;
      width: 100%;

    }

    iframe {
        border: none;
        flex: 1 0 auto;
        width: 100%;
    }

  #navbar {
      background-color: #6DC0F2;
      position: absolute;
      width: 100%;
      z-index: 1;
      top: 0;
      height: 55px;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #clean-up {
      background-color: #80CFFF;
      border: none;
      color: white;
    }

    .btn-default {
      background-color: #49A6DF;
      border: none;
      color: white;
    }

    #container {
      width: 100%;
      display: flex;
      flex-direction: row;
      margin-top: 55px;
    }

    #previewbar, #docsbar, #projectbar, #codebar {
       flex-grow: 0.65;
       align-items: center;
       display: none;
       width: 25px;
       flex-direction: column;
       justify-content: center;
    }

    #output, #docs, #projects, #code {
      flex-flow: column wrap;
      resize: none;
      flex: 10 1 25%;
    }

    #code {
      word-wrap: break-word;
      width: 25%;
    }

    #PreviewNav, #DocsNav, #ProjectsNav, #CodeNav {
      height: 25px;
      text-align: center;
      color: white;
      font-size: 1.1em;
      display: flex;
      justify-content: space-between;
    }

    #previewbar, #PreviewNav {
    background-color:#4875D1;
    }

    #docsbar, #DocsNav {
      background-color: #7F68D5;
    }

    #projectbar, #ProjectsNav {
      background-color: #AD5FC2;
    }

    #codebar, #CodeNav {
      background-color: #49A6DF;
    }

    @media all and (max-width: 600px) {
      fieldset {
        display: none;
      }
    }

    #pop {
      cursor: pointer;
    }

    @keyframes glowing {
      0% { background-color: #B20000; box-shadow: 0 0 1px #c9302c; }
      50% { background-color: #FF0000; box-shadow: 0 0 2px #FF0000; }
      100% { background-color: #B20000; box-shadow: 0 0 1px #c9302c; }
    }

    #error {
      display: none;
      color: white;
      margin-right: 5px;
    }

    .rotate {
      color: #FFFFFF;
      -webkit-transform: rotate(90deg);
      -moz-transform: rotate(90deg);
      -ms-transform: rotate(90deg);
      -o-transform: rotate(90deg);
      transform: rotate(90deg);
    }

    kbd{
      background-color: #ababab;
    }



  </style>
</head>
<body>
  <div id="page">
    <div id="navbar">

    <div class="btn-group" role="group" aria-label="..." id='loginSingupGroup' :class='{show: loginState == "LOGGEDOUT", hide: loginState == "LOGGEDIN"}'>
      <button style="margin-left: 5px;" class="btn btn-medium btn-primary" type="button" id="login" :class='{show: loginState == "LOGGEDOUT", hide: loginState == "LOGGEDIN"}' onclick="$('#loginModal').modal('show');" @click="switchToLogin()">Login</button>
      <button class="btn btn-medium btn-success" type="button" id="signup" :class='{show: loginState == "LOGGEDOUT", hide: loginState == "LOGGEDIN"}' onclick="$('#loginModal').modal('show');" @click="switchToSignUp()">Sign Up</button>
    </div>

      <div style="margin-left: 5px" id="logggedin" class="hide dropdown" :class='{hide: loginState == "LOGGEDOUT", show: loginState == "LOGGEDIN"}'>
        <button class="btn btn-medium btn-info dropdown-toggle" type="button" id="loggedin-name" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{userNameForMenu}} <span class="caret"></span></button>
        <ul class="dropdown-menu" aria-labelledby="loggedin-name">
          <li><a href="./create.html">New Project</a></li>
          <li><a href="./team.html">New Team Project <span class="label label-success">beta</span></a></li>
          <li><a target="_blank" id="login-projects" :href="userProjectsLink">My Projects</a></li>
          <li onclick="firebase.auth().signOut()"><a>Logout</a></li>
          <li role="separator" class="divider"></li>
          <li class="dropdown-header">Recent Projects</li>
          <li v-for="project in projects.slice(0,10)"><a :href="'#' + project.key">{{project.key}}</a></li>
        </ul>
      </div>

      <img  style= "width:160px; height: 40px;" src="./images/logowhite.png">
      <span style="margin:8px" id="save">

      
        <button id="error" class="btn btn-danger" @click="showError()" :style="{display: error ? 'inline-block' : 'none', animation: seenError ? 'none' : 'glowing 1200ms infinite'}"><span class="glyphicon glyphicon-exclamation-sign"></span> Error</button>
        <div class="dropdown" style="display:inline;">
          <button class="btn btn-primary btn-medium dropdown-toggle" type="button" id="toolsDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true" style='border:none;'>
            Tools
            <span class="caret"></span>
          </button>
          <ul class="dropdown-menu dropdown-menu-right" aria-labelledby="toolsDropdown" style="margin-top:12px;">
            <li><a @click="undo()"><span class="fa fa-undo"></span> Undo <span><kbd>{{shortcut}}</kbd>+<kbd>Z</kbd></span></a></li>
            <li><a @click="redo()"><span class="fa fa-repeat"></span> Redo <span><kbd>{{shortcut}}</kbd>+<kbd>Shift</kbd>+<kbd>Z</kbd></span></a></li>
            <li><a @click="selectAll()"><span class="fa fa-bars"></span> Select All <span><kbd>{{shortcut}}</kbd>+<kbd>A</kbd></span></a></li>
            <li><a @click="find()"><span class="fa fa-search"></span> Find <span><kbd>{{shortcut}}</kbd>+<kbd>F</kbd></span></a></li>
            <li role="separator" class="divider"></li>
            <li><a><input onclick="autoRunClicked()" type="checkbox" id="checkbox" v-model="autoRunChecked"></span> Auto Run</a></li>
            <li role="separator" class="divider"></li>
            <li><a @click="cleanAll()" :style="{display: canClean ? 'block' : 'none'}"><span class="glyphicon glyphicon-align-left"></span> Clean Code <span><kbd>{{shortcut}}</kbd>+<kbd>B</kbd></span></a></li>
            <li><a @click="cleanAll()" class='disabled' :style="{display: canClean ? 'none' : 'block'}" data-toggle="popover" data-trigger="hover" data-content="You can't clean when there's an error." data-placement="top"><span class="glyphicon glyphicon-align-left"></span> Clean Code <span><kbd>{{shortcut}}</kbd>+<kbd>B</kbd></span></a></li>
            <li role="separator" class="divider"></li>
            <li><a @click="share()"><span class="glyphicon glyphicon-share-alt"></span> Share</a></li>
          </ul>
        </div>
        <button style="display: none" :style="{display: 'inline-block'}" style="margin-right: 5px; background-color:#4390BF !important; ; border:none; color:white; " class="btn btn-medium" :class="styles" onclick="save()">{{ status == "SAVED" ? 'Saved' : 'Save' }}</button> 
      </span>
    </div>

    <div class="modal fade" id="saveModal" tabindex="-1" role="dialog" aria-labelledby="saveModalLabel">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="saveModalLabel">Choose a name for your project</h4>
          </div>
          <div class="modal-body">
            <div id="projectNameGroup" class="form-group" :class="{'has-info': projectNameInputValue == '', 'has-error': projectNameRequest == 'NAME TAKEN', 'has-success': projectNameInputValue != '' && projectNameRequest != 'NAME TAKEN', animated: projectNameRequest == 'NAME TAKEN' || projectNameLastKeyIllegal, shake: projectNameRequest == 'NAME TAKEN' || projectNameLastKeyIllegal}">
              <input type="text" class="form-control" id="projectName" placeholder="my-project" :value="projectNameInputValue" @input="validate($event)" @keyDown.enter="saveName(projectNameInputValue)">
              <span id="nameTaken" :style="{opacity: projectNameRequest == 'NAME TAKEN' ? '1' : '0'}" class="text-danger">That project name has already been taken. Try another one.</span>
            </div>
            <span id="illegalCharacter" class="text-danger" :class="{animated: projectNameLastKeyIllegal, shake: projectNameLastKeyIllegal}" style="display: inline-block" :style="{opacity: projectNameLastKeyIllegal ? '1' : '0'}">You cannot include {{ projectNameLastKeyIllegal }} in project names.</span>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
            <button type="button" id="saveChanges" class="btn btn-primary" :class="{disabled: projectNameRequest != 'NOT LOADING' || projectNameInputValue == ''}" @click="saveName()">{{ projectNameRequest == "LOADING" ? "Loading..." : "Save" }}</button>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="migrateModal" tabindex="-1" role="dialog" aria-labelledby="migrateModal">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h4 class="modal-title" id="migrateModalLabel">We are updating our systems and need you to choose a new username. Don't use your real name!</h4>
          </div>
          <div class="modal-body">
            <div class="form-group" :class="{'has-success': migrateUsernameValid == 'VALID', 'has-error': migrateUsernameValid == 'TAKEN', animated: migrateUsernameValid == 'TAKEN' || migrateUsernameKeyIllegal,  shake: migrateUsernameValid == 'TAKEN' || migrateUsernameKeyIllegal}">
              <label for='username'>Username</label>
              <input v-model='migrateUsername' onfocus="$('#usernameMigrate').tooltip('toggle')" data-placement="top" title="Don't use your real name" type="text" class="form-control" id="usernameMigrate" placeholder="Username" aria-describedby="usernameMigrateHelp" @input="migrateUsernameVaidate($event)" onkeydown="if (event.keyCode == 13){migrate()}" >
              <span id="usernameMigrateHelp" class="help-block" :style="{display: migrateUsernameValid == 'TAKEN' ? 'block' : 'none'}">This username is already taken. Please try another username.</span>
              <span id="usernaemeMigrateHelp" class="help-block" style='color:#BD362F;' :style="{display: migrateUsernameKeyIllegal ? 'block' : 'none'}">You cannot include {{ migrateUsernameKeyIllegal }} in usernames.</span>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" v-model='migrateChecked'> I want to recieve updates about WoofJS
              </label>
            </div>
            <div class="form-group" style="text-align:center;">
              <div>
                <button type="submit" class="btn btn-primary" style="width:100%;" :class="{disabled: migrateButtonState == 'LOADING'}" onclick="migrate()">
                  <i class="fa fa-spinner fa-pulse fa-fw" style="margin:0 auto;" :style="{display: migrateButtonState == 'LOADING' ? 'block' : 'none'}"></i>
                  <span :style="{display: migrateButtonState == 'LOADING' ? 'none' : 'block'}">Update</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="loginModal" tabindex="-1" role="dialog" aria-labelledby="loginModalLabel">
      <div class="modal-dialog" role="document">

        <div class="modal-content" :style="{display: loginSignUpView == 'LOGIN' ? 'block' : 'none'}">
          <div class="modal-header" :class="{animated: loginSignUpView == 'LOGIN', fadeIn: loginSignUpView == 'LOGIN'}">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h1 class="modal-title" id="loginModalLabel">Log In</h1>
          </div>
          <div class="modal-body" :class="{animated: loginSignUpView == 'LOGIN', fadeIn: loginSignUpView == 'LOGIN'}">
            <div class="form-group" :class="{'has-error': loginError == 'USERNOTFOUND' || loginError == 'INVALIDEMAIL' || loginError == 'USERNAMENOTUNIQUE',  animated: loginError == 'USERNOTFOUND' || loginError == 'INVALIDEMAIL' || loginError == 'USERNAMENOTUNIQUE',  shake: loginError == 'USERNOTFOUND' || loginError == 'INVALIDEMAIL' || loginError == 'USERNAMENOTUNIQUE'}">
              <label for='username'>Username or Email</label>
              <input type="text" v-model="loginEmail" class="form-control" id="username" placeholder="Username or Email" aria-describedby="usernameHelp">
              <span id="usernameHelp" class="help-block" :style="{display: loginError == 'USERNOTFOUND' ? 'block' : 'none'}">No account with this username or email exists. Please try to sign up for an account.</span>
               <span id="usernameHelp" class="help-block" :style="{display: loginError == 'INVALIDEMAIL' ? 'block' : 'none'}">Invalid email address. Please try again.</span>
               <span id="usernameHelp" class="help-block" :style="{display: loginError == 'USERNAMENOTUNIQUE' ? 'block' : 'none'}">We have no record of this username.</span>
            </div>
            <div class="form-group" :class="{'has-error': loginError == 'WRONGPASSWORD',  animated: loginError == 'WRONGPASSWORD',  shake: loginError == 'WRONGPASSWORD'}">
              <label for='password'>Password</label>
              <input onkeydown="if (event.keyCode == 13){login()}"  type="password" v-model="loginPassword" class="form-control" id="password" placeholder="Password" aria-describedby="passwordHelp">
              <span id="passwordHelp" class="help-block" :style="{display: loginError == 'WRONGPASSWORD' ? 'block' : 'none'}">Invalid password. Please try again.</span>
            </div>
            <div class="form-group" style="text-align:center;">
              <div>
                <button type="submit" class="btn btn-primary" style="width:100%;" :class="{disabled: loginButtonState == 'LOADING'}" onclick="login()">
                  <i class="fa fa-spinner fa-pulse fa-fw" style="margin:0 auto;" :style="{display: loginButtonState == 'LOADING' ? 'block' : 'none'}"></i>
                  <span :style="{display: loginButtonState == 'NORMAL' ? 'block' : 'none'}">Log In</span>
                </button>
                <br>
                <br>
                <small style="color:grey;">Don't have an account? <a @click="switchToSignUp()" style="cursor: pointer;text-decoration:none;">Sign Up</a></small>
                <br>
                <br>
                <small style="color:grey;"><a @click="switchToPasswordReset()" style="cursor: pointer;color:grey;">Forgot your password?</a></small>
              </div>
            </div>
          </div>
        </div>

        <div class="modal-content" :style="{display: loginSignUpView == 'SIGNUP' ? 'block' : 'none'}">
          <div class="modal-header" :class="{animated: loginSignUpView == 'SIGNUP', fadeIn: loginSignUpView == 'SIGNUP'}">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h1 class="modal-title" id="loginModalLabel">Sign Up</h1>
          </div>
          <div class="modal-body" :class="{animated: loginSignUpView == 'SIGNUP', fadeIn: loginSignUpView == 'SIGNUP'}">
            <div class="form-group" :class="{'has-success': usernameValid == 'VALID', 'has-error': usernameValid == 'TAKEN', animated: usernameValid == 'TAKEN' || usernameLastKeyIllegal,  shake: usernameValid == 'TAKEN' || usernameLastKeyIllegal}">
              <label for='username'>Username</label>
              <input v-model='signUpUsername' onfocus="$('#usernameCreate').tooltip('toggle')" data-placement="top" title="Don't use your real name" type="text" class="form-control" id="usernameCreate" placeholder="Username" aria-describedby="usernameCreateHelp" @input="usernameValidate($event)">
              <span id="usernameCreateHelp" class="help-block" :style="{display: usernameValid == 'TAKEN' ? 'block' : 'none'}">This username is already taken. Please try another username.</span>
              <span id="usernameCreateHelp" class="help-block" style='color:#BD362F;' :style="{display: usernameLastKeyIllegal ? 'block' : 'none'}">You cannot include {{ usernameLastKeyIllegal }} in usernames.</span>
            </div>
            <div class="form-group" :class="{'has-success': emailValid == 'VALID', 'has-error': emailValid == 'TAKEN' || emailValid == 'NOTEMAIL',  animated: emailValid == 'TAKEN' || emailValid == 'NOTEMAIL',  shake: emailValid == 'TAKEN' || emailValid == 'NOTEMAIL'}">
              <label for='username'>Email</label>
              <input type="email" v-model='signUpEmail' class="form-control" id="emailCreate" placeholder="Email" aria-describedby="emailCreate" @blur="emailValidate($event)" @input="emailSuccessValidate">
              <span id="emailCreate" class="help-block" :style="{display: emailValid == 'TAKEN' ? 'block' : 'none'}">An account with this email aready exists. Please try to <a @click="switchToLogin()" onclick='app.loginEmail = app.signUpEmail'>log in</a>.</span>
              <span id="emailCreate" class="help-block" :style="{display: emailValid == 'NOTEMAIL' ? 'block' : 'none'}">Please enter a valid email.</span>
            </div>
            <div class="form-group" :class="{'has-success': passwordValid == 'VALID', 'has-error': passwordValid == 'WEAK','animated': passwordValid == 'WEAK','shake': passwordValid == 'WEAK'}">
              <label for='username'>Password</label>
              <input type="password" v-model='signUpPassword' class="form-control" id="passwordCreate" placeholder="Password" aria-describedby="passwordCreateHelp" @input="passwordSuccessValidate" @blur="passwordValidate($event)" onkeydown="if (event.keyCode == 13){signUp()}">
              <span id="passwordCreateHelp" class="help-block" :style="{display: passwordValid == 'WEAK' ? 'block' : 'none'}">Passwords must be at least 6 characters long.</span>
            </div>
            <div class="checkbox">
              <label>
                <input type="checkbox" v-model='signUpChecked'> I want to recieve updates about WoofJS
              </label>
            </div>
            <div class="form-group" style="text-align:center;">
              <div>
                <button type="submit" class="btn btn-primary" style="width:100%;" :class="{disabled: signUpButtonState == 'LOADING'}" onclick="signUp()">
                  <i class="fa fa-spinner fa-pulse fa-fw" style="margin:0 auto;" :style="{display: signUpButtonState == 'LOADING' ? 'block' : 'none'}"></i>
                  <span :style="{display: signUpButtonState == 'LOADING' ? 'none' : 'block'}">Sign Up</span>
                </button>
                <br>
                <br>
                <small style="color:grey;">Already have an account? <a @click="switchToLogin()" style="cursor: pointer;text-decoration:none;">Log In</a></small>
              </div>
            </div>
          </div>
        </div>


        <div class='modal-content' :style="{display: loginSignUpView == 'RESETPASSWORD' || loginSignUpView == 'RESETPASSWORDSUCCESS'  ? 'block' : 'none'}">
          <div class="modal-header" :class="{animated: loginSignUpView == 'RESETPASSWORD', fadeIn: loginSignUpView == 'RESETPASSWORD'}">
            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
            <h1 class="modal-title" id="loginModalLabel">Recover Password</h1>
          </div>

          <div class="modal-body" :style="{display: loginSignUpView == 'RESETPASSWORD' ? 'block' : 'none'}" :class="{animated: loginSignUpView == 'RESETPASSWORD', fadeIn: loginSignUpView == 'RESETPASSWORD'}">
            <h5>Get instructions sent to this email that explain how to reset your password.</h5>
            <div class="form-group">
              <label for='emailReset'>Email</label>
              <input onkeydown="if (event.keyCode == 13){resetPassword()}" type="email" v-model="resetEmail" class="form-control" id="emailReset" placeholder="Email">
            </div>
            <div class="form-group" style="text-align:center;">
              <div>
                <button type="submit" class="btn btn-primary" style="width:100%;" onclick="resetPassword()" >
                  Send
                </button>
                <br>
                <br>
                <small style="color:grey;">Remember your password? <a @click="switchToLogin()" style="cursor: pointer;text-decoration:none;">Log In</a></small>
              </div>
            </div>
          </div>

          <div class="modal-body" :style="{display: loginSignUpView == 'RESETPASSWORDSUCCESS' ? 'block' : 'none'}" :class="{animated: loginSignUpView == 'RESETPASSWORDSUCCESS', fadeIn: loginSignUpView == 'RESETPASSWORDSUCCESS'}">
            <h5>If there is an account associated with that email address, we have sent it a password reset email.</h5>   
          </div>

        </div>


      </div>
    </div>

    <div id="container">

      <div id="previewbar" v-show="previewbar" @click="previewbar= !previewbar" :style="{display: 'flex'}">
        <span class="rotate" style="font-size: 1.65em">Preview</span>
      </div>
      <div v-show="outputPane" :style="{display: !previewbar ? 'flex' : 'none'}" id="output">
        <div id="PreviewNav">
          <span style="margin-left:8px; margin-top:4px">Preview</span>
          <span style="margin-right:8px">
            <span style="display: none; font-family: monospace; font-size: 11px" :style="{display: status ? 'inline-block' : 'none'}">mouseX: {{mouseX}}</span>
            <span style="display: none; font-family: monospace; font-size: 11px" :style="{display: status ? 'inline-block' : 'none'}">mouseY: {{mouseY}}</span>
            <img onclick="runCode(); focusPreview()" id="pop" style="margin: 2px; width: 17px; height:17px" src="./images/refresh.png" title="Reload">
            <img  onclick="popout()" id="pop" style="margin: 2px; width: 17px; height:17px" src="./images/pop.png" title="Open in new tab">
            <img  @click="previewbar = !previewbar"  style="margin: 5px; width: 16px; height:18px; cursor:pointer" src="./images/minimize.png" title="Minimize">
          </span>
        </div>
        <iframe scrolling="no" id="preview"></iframe>
      </div>

      <div id="shareModal" class="modal fade" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
              <h4 class="modal-title"><span class="glyphicon glyphicon-share-alt"></span> Share this project</h4>
            </div>
            <h4 class="modal-body text-danger" :style="{display: !getID() ? 'block' : 'none'}">You must save a project in order to share it.</h4>
            <div class="modal-body" :style="{display: getID() ? 'block' : 'none'}">
          

              <div class="form-group">
                <label for="link">Code & Output</label>
                <input type="text" class="form-control" id="link"  :value="link()">
              </div>
              <div class="form-group">
                <label for="fullLink">Full Screen Output</label>
                <input type="text" class="form-control" id="fullLink"  :value="fullLink()">
              </div>
              <div class="form-group">
                <label for="embed">Embed</label>
                <input type="text" class="form-control" id="embed"  :value="embed()">
              </div>
            </div>
          </div>
        </div>
      </div>
    
      <div id="docsbar" v-show="docsbar" @click="docsbar= !docsbar" :style="{display: 'flex'}">
        <span class="rotate" style="font-size: 1.65em">Documentation</span>
      </div>
      <div v-show="docsPane" :style="{display: !docsbar ? 'flex' : 'none'}" id="docs">
        <div id="DocsNav">
          <span style="margin-left:8px;  margin-top:4px">Documentation</span>
          <span style="margin-right:8px">
            <img   @click="docsbar = !docsbar"  style="margin-left:5px; width: 16px; height:18px; cursor:pointer" src="./images/minimize.png"  title="Minimize">
          </span>
        </div>
        <iframe src="./docs/index.html" id="scratch"></iframe>
      </div>


      <div id="projectbar" v-show="projectbar" @click="projectbar= !projectbar" :style="{display: 'flex'}" @click="projectsPane = !projectsPane">
        <span class="rotate" style="font-size:1.65em">Tutorials</span>
      </div>
      <div v-show="projectsPane" :style="{display: !projectbar ? 'flex' : 'none'}"  :style="{display: 'flex'}" id="projects">
        <div id="ProjectsNav">
          <span style="margin-left:8px; margin-top:4px">Tutorials</span>
          <span style="margin-right:8px">
            <img @click="projectbar = !projectbar" style="margin: 5px; width: 16px; height:18px; cursor:pointer" src="./images/minimize.png" title="Minimize">
          </span>
        </div>
        <iframe id="projectsIframe" src="http://coding.space/woof/index.html"></iframe>
      </div>


      <div id="codebar" v-show="codebar" @click="codebar= !codebar" :style="{display: 'flex'}">
        <span class="rotate" style="font-size:1.65em">Code</span>
      </div>
      <div v-show="codePane" :style="{display: !codebar ? 'flex' : 'none'}" id="code">
        <div id="CodeNav">
          <div>
            <span style="margin-left:8px; margin-top:4px">Code</span>
            <select :value ="selectedTheme" style="color: white; margin-top: 4px; background-color: #49a6df; height: 18px; border: 1px solid white; border-radius: 3px;" @change="themeChange($event)">
              <option>monokai</option>
              <option>cobalt</option>
              <option>ambiance</option>
              <option>blackboard</option>
              <option>erlang-dark</option>
              <option>lesser-dark</option>
              <option>eclipse</option>
              <option>3024-night</option>
              <option>base16-dark</option>
              <option>elegant</option>
              <option>midnight</option>
              <option>night</option>
            </select>
          </div>
          <div>
            <span style="margin-right:8px">
              <img @click="codebar = !codebar" style="margin: 5px; width: 16px; height:18px; cursor:pointer" src="./images/minimize.png" title="Minimize">
            </span>
          </div>
        </div>
      </div>

    </div>
  </div>
  <script>

    var getID = function() {
      // returns the name of a project, not inlcuding the current revision
      return window.location.hash.substring(1, window.location.hash.length).split("/")[0];
    }
    var getIDWithRevision = function() {
      // returns the name of a project, inlcuding the current revision
      return window.location.hash.substring(1, window.location.hash.length);
    }
    var getCurrentRevisionCode = function(revisions) {
      // returns the code that corresponds to the current project and revision
      var revision = parseInt(window.location.hash.substring(1, window.location.hash.length).split("/")[1])

      var keys = Object.keys(revisions)
      if (keys.length > 1){
        keys = keys.slice(1, keys.length)
      }


      var key
      if (!isNaN(revision) && (revision !== 0 && revision !== -1 * keys.length) && Math.abs(revision) < keys.length + 1){
        if (revision < 0){
          revision = keys.length + revision // -1 gives the previous revision
        }
        key = keys[revision - 1]
      } else {
        key = keys[keys.length - 1]
      }
      return revisions[key].code
    }
    var currentHash = window.location.hash

    var app = new Vue({
      el: '#page',
      data: {
        code: "",
        status: "NEW",
        error: undefined,
        projects: [],
        codePane: true,
        outputPane: true,
        projectsPane: false,
        docsPane: true,
        projectbar: true,
        previewbar: false,
        docsbar:false,
        codebar:false,
        mouseX: 0,
        mouseY: 0,
        seenError: true,
        selectedTheme:'eclipse',
        autoRunChecked: true,
        shortcut: CodeMirror.keyMap["default"] == CodeMirror.keyMap.macDefault ? 'Cmd' : 'Ctrl',     
        projectNameRequest: "NOT LOADING", // or "LOADING" or "NAME TAKEN"
        projectNameInputValue: "",
        projectNameLastKeyIllegal: false,
        usernameLastKeyIllegal: false,
        loginSignUpView: "LOGIN", // or SIGNUP or RESETPASSWORD or RESETPASSWORDSUCCESS
        emailError: false,
        usernameValid: "EMTPY", // TAKEN or VALID or EMPTY or ILLEGAL
        emailValid: "EMTPY", // TAKEN or VALID or NOTEMAIL or EMPTY
        passwordValid: "EMTPY", // VALID or EMPTY or WEAK
        loginError: "NONE", // NONE or USERNOTFOUND or WRONGPASSWORD or INVALIDEMAIL
        loginButtonState: "NORMAL", // NORMAL or LOADING
        signUpButtonState: "DISABLED", // NORMAL or DISABLED or LOADING
        loginPassword: "",
        loginEmail: "",
        resetEmail: "",
        signUpEmail: '',
        signUpPassword: '',
        signUpChecked: true,
        signUpUsername: '',
        
        loginState: "LOGGEDOUT", // or LOGGEDIN
        userNameForMenu: '',
        userProjectsLink: '',
        
        migrateUsernameValid: "EMTPY", // TAKEN or VALID or EMPTY or ILLEGAL
        migrateUsernameKeyIllegal: false,
        migrateUsername: '',
        migrateChecked: true,
        migrateButtonState: "DISABLED", // NORMAL or DISABLED or LOADING

      },
      computed: {
        styles : function() { return {
           // styles for the "Save" button
          'btn-warning': this.status == 'DIRTY',
          'btn-success': this.status == 'SAVED',
          'btn-default': this.status == "NEW"
        } },
        canClean: function(){
          return !this.error 
        },
      },
      methods: {
        getID: getID,
        showError: function(){
          this.seenError = true
          if (this.error.message.includes('Uncaught ReferenceError: sprite1 is not defined')) {
            var spriteName = prompt("Error on line " + this.error.lineno  + "\n\n" + "You need to rename 'sprite1'. What would you like to name it?", "unicornSprite");
            if (spriteName !== null) {
                editor.setValue(editor.getValue().replace(/sprite1/g, spriteName));
            }
          }
          else if (this.error.message.includes("Uncaught ReferenceError")) {
            var message = this.error.message.replace("Uncaught ReferenceError: ", "")
            alert("Error on line " + this.error.lineno  + "\n\n" + message + ". Check the spelling of your variable definitions.")
          }
          else {
             alert("Error on line " + this.error.lineno  + "\n\n" + this.error.message)
          }
        },
        cleanAll: function(){
          if (!this.error && this.code != js_beautify(this.code, {space_after_anon_function: true, indent_size: 2, indent_with_tabs: false })){
            var beautiful = js_beautify(editor.getValue(), {space_after_anon_function: true, indent_size: 2, indent_with_tabs: false })
            editor.setValue(beautiful)
          }
        },
        share: function(){
          $('#shareModal').modal('show')
        },
        link: function(){
          return "http://woofjs.com/create.html#" + getID()
        },
        fullLink: function(){
          return "http://woofjs.com/full.html#" + getID()
        },
        embed: function(){
          return "<iframe src=\"http://woofjs.com/full#" + getID() + "\">\n</iframe>"
        },
        selectAll: function(){
          editor.execCommand("selectAll")
        },
        undo: function(){
          editor.execCommand("undo")
        },
        redo: function(){
          editor.execCommand("redo")
        },
        find: function(){
          editor.execCommand("find")
        },
        validate: function($event) {
          var newName = $event.target.value

          this.projectNameRequest = 'NOT LOADING'  // reset state so that you can hit save after you change the name after you get a NAME TAKEN error

          this.projectNameLastKeyIllegal = false // take off the animation
          setTimeout(function() {
            var lastKeyPressIllegal = newName.length > 0 && newName[newName.length - 1].match(/\.|#|\$|\/|\[|\]/)
            if (lastKeyPressIllegal) {
              this.projectNameLastKeyIllegal = lastKeyPressIllegal[0]
            } else {
              this.projectNameLastKeyIllegal = false
            }
          }.bind(this), 10)


          this.projectNameInputValue = newName.replace(/ /g, "-")
          this.projectNameInputValue = this.projectNameInputValue.replace(/\.|#|\$|\/|\[|\]/g, "")
        },
        saveName : function() {
          if (app.projectNameRequest == "NOT LOADING"){
            app.projectNameRequest = "LOADING"
            var name = app.projectNameInputValue
            if (name) {
              saveProject(name);
            }
          }
        },
        themeChange: function (event){
          var newTheme = event.target.value;
          app.selectedTheme = newTheme;
          editor.setOption("theme", newTheme);
          if(firebase.auth().currentUser){
            firebase.database().ref("/user/" + firebase.auth().currentUser.uid + "/theme").set(newTheme)
          } 
        },
        switchToSignUp: function(){
          this.loginSignUpView = 'SIGNUP'
        },
        switchToLogin: function(){
          this.loginSignUpView = 'LOGIN'
        },
        switchToPasswordReset: function(){
           this.loginSignUpView = 'RESETPASSWORD'
        },
        usernameValidate: function($event){
          var username = $event.target.value
          if (username == ''){
            this.usernameValid = "EMPTY"
          } else {
            this.usernameLastKeyIllegal = false
            setTimeout(function() {
              var lastKeyPressIllegal = username.length > 0 && username[username.length - 1].match(/\.|#|\$|\/|\[|\]/)
              if (lastKeyPressIllegal) {
                this.usernameLastKeyIllegal = lastKeyPressIllegal[0]
              } else {
                this.usernameLastKeyIllegal = false
              }
            }.bind(this), 10)

            this.signUpUsername= username.replace(" ", "-")
            this.signUpUsername = this.signUpUsername.replace(/\.|#|\$|\/|\[|\]/g, "")
            this.usernameValid = "VALID"
          }
        },
        migrateUsernameVaidate: function($event){
          var username = $event.target.value
          if (username == ''){
            this.usernameValid = "EMPTY"
          } else {
            this.migrateUsernameKeyIllegal = false
            setTimeout(function() {
              var lastKeyPressIllegal = username.length > 0 && username[username.length - 1].match(/\.|#|\$|\/|\[|\]/)
              if (lastKeyPressIllegal) {
                this.migrateUsernameKeyIllegal = lastKeyPressIllegal[0]
              } else {
                this.migrateUsernameKeyIllegal = false
              }
            }.bind(this), 10)

            this.migrateUsername= username.replace(" ", "-")
            this.migrateUsername = this.migrateUsername.replace(/\.|#|\$|\/|\[|\]/g, "")
            this.migrateUsernameValid = "VALID"
          }
        },
        // Checks for success or error on blur
        emailValidate: function($event){
          var email = $event.target.value
          if (email == ''){
            this.emailValid = "EMPTY"
          } else if (!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(email)){
            this.emailValid = "NOTEMAIL"
          } else if (/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(email)){
            this.emailValid = "VALID"
          }
        },
        // Checks for success or error on blur
        passwordValidate: function($event){
          var password = $event.target.value
          if (password == ''){
            this.passwordValid = "EMPTY"
          } else if (!/^.{6,}$/.test(password)){
            this.passwordValid = "WEAK"
          } else {
            this.passwordValid = "VALID"
          }
        },
        // Checks for success on every input
        emailSuccessValidate: function($event){
          var email = $event.target.value
          if (/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(email)){
            this.emailValid = "VALID"
          }
        },
        // Checks for success on every input
        passwordSuccessValidate: function($event){
          var password = $event.target.value
          if (/^.{6,}$/.test(password)){
            this.passwordValid = "VALID"
          }
        },
        
      },
      watch: {
        error: function(newError) {
          if (newError && newError.lineno) {
            CodeMirror.commands.markGutter(editor, "error", newError.lineno, newError.message)
          }
        },
      }
    })
  
    //Initalizes the popover for the comment code button in the tools menu
    $(document).ready(function(){
        $('[data-toggle="popover"]').popover();   
    });

    var clipboard = new Clipboard('.btn-clipboard');
    Vue.nextTick(function() {
        $('[data-toggle="tooltip"]').tooltip({
            trigger: 'manual'
        });
        clipboard.destroy()
        clipboard = new Clipboard('.btn-clipboard');
        clipboard.on('success', function(e) {
            $(e.trigger).tooltip('show')
            setTimeout(function() {
                $(e.trigger).tooltip('hide')
            }, 1000)
        });

    })

    var myCode = false
    scratch.src = scratch.src // the documentation sometimes doesn't load unless you remind it to here, strange VueJS bug
    projectsIframe.src = projectsIframe.src // ditto for the project's iframe

    var config = {
      apiKey: "AIzaSyBYHv7dCiD0bWiHRlcp4VIZCIqzoMnB4yY",
      authDomain: "woofjs-d1b27.firebaseapp.com",
      databaseURL: "https://woofjs-d1b27.firebaseio.com",
      storageBucket: "woofjs-d1b27.appspot.com",
      messagingSenderId: "397293370524"
    };
    firebase.initializeApp(config);

    function clearLoginSignupModal() {
      app.emailError = false;
      app.usernameValid = "EMTPY";
      app.emailValid = "EMTPY";
      app.passwordValid = "EMTPY";
      app.loginError = "NONE";
      app.loginButtonState = "NORMAL";
      app.signUpButtonState = "DISABLED";
      app.loginPassword = "";
      app.loginEmail = "";
      app.resetEmail = "";
      app.signUpEmail = '';
      app.signUpPassword = '';
      app.signUpChecked = true;
      app.signUpUsername = '';
    }

    function loginWithEmail(email, pass){
      firebase.auth().signInWithEmailAndPassword(email, pass)
        .then(function() {
          $('#loginModal').modal('hide');
          clearLoginSignupModal();
          app.projects = []

        })
        .catch(function(error) {
          if (error.code === 'auth/wrong-password') {
            app.loginError = "WRONGPASSWORD"
            app.loginButtonState = "NORMAL"
          } else if (error.code === 'auth/invalid-email') {
            app.loginError = "INVALIDEMAIL"
            app.loginButtonState = "NORMAL"
          } else {
            app.loginError = "USERNOTFOUND"
            app.loginButtonState = "NORMAL"
          }
        })
    }

    function migrate(){
      if (app.migrateUsernameValid == 'VALID' && app.migrateButtonState != 'LOADING') {
        app.migrateButtonState = "LOADING"

        var exists
        var ref = firebase.database().ref("uniqueUsername");

        ref.child(app.migrateUsername).once('value', function(snapshot) {
          exists = (snapshot.val() !== null);
          if (exists) {
            app.migrateUsernameValid = 'TAKEN'
            app.migrateButtonState = "NORMAL"
          } else {

            var user = firebase.auth().currentUser;

            user.updateProfile({
              displayName: app.migrateUsername,
              recieveUpdates: app.migrateChecked,
              usernameUnique: true
            })

            firebase.database().ref("uniqueUsername/" + app.migrateUsername).set({
              username: app.migrateUsername,
              uid: user.uid
            })

            app.userNameForMenu = app.migrateUsername

            var ref = firebase.database().ref("user");
            ref.child(user.uid).once('value', function(snapshot) {
              var createdDateVar = snapshot.val().createdDate;
              var emailVar = snapshot.val().email;

              var updates = {};

              updates['/user/' + user.uid] = {
                createdDate: createdDateVar,
                displayName: app.migrateUsername,
                email: emailVar,
                recieveUpdates: app.migrateChecked,
                usernameUnique: true
              }

              $('#migrateModal').modal('hide');
              app.migrateButtonState = "NORMAL"
              app.migrateUsername = ''
              app.migrateUsernameValid = 'EMPTY'

              return firebase.database().ref().update(updates);
            });

          }
        });

      } 
    }
    
    function login() {
      app.loginButtonState = "LOADING"

      if (!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(app.loginEmail)){
        var ref = firebase.database().ref("user");
        ref.orderByChild("displayName").equalTo(app.loginEmail).on("value", function(snapshot) {
          if (snapshot.numChildren()==1){
            loginWithEmail(snapshot.val()[Object.keys(snapshot.val())[0]].email, app.loginPassword)
          } else if (snapshot.numChildren()>1){
            app.loginError = "USERNAMENOTUNIQUE"
            app.loginButtonState = "NORMAL"
          }else{
            app.loginError = "USERNOTFOUND"
            app.loginButtonState = "NORMAL"
          }
        });
      } else {
        loginWithEmail(app.loginEmail, app.loginPassword)
      }
    }

    function signUp() {
      var email = app.signUpEmail;
      var password = app.signUpPassword;
      if (email == ''){
        app.emailValid = "EMPTY"
      } else if (!/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(email)){
        app.emailValid = "NOTEMAIL"
      } else if (/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(email)){
        app.emailValid = "VALID"
      } 
      if (password == ''){
        app.passwordValid = "EMPTY"
      } else if (!/^.{6,}$/.test(password)){
        app.passwordValid = "WEAK"
      } else {
        app.passwordValid = "VALID"
      }

      if (app.usernameValid == 'VALID' && app.emailValid == 'VALID' && app.passwordValid == 'VALID' && app.signUpButtonState != 'LOADING') {
        app.signUpButtonState = "LOADING"

        var exists
        var ref = firebase.database().ref("uniqueUsername");
        ref.child(app.signUpUsername).once('value', function(snapshot) {
          exists = (snapshot.val() !== null);
          if (exists) {
            app.usernameValid = 'TAKEN'
            app.signUpButtonState = "NORMAL"
          } else {
            firebase.auth().createUserWithEmailAndPassword(app.signUpEmail, app.signUpPassword)
              .then(function() {

                $('#loginModal').modal('hide');

                var user = firebase.auth().currentUser;

                user.updateProfile({
                  displayName: app.signUpUsername
                })

                
                app.userNameForMenu = app.signUpUsername
                app.projects = []

                firebase.database().ref("uniqueUsername/" + app.signUpUsername).set({
                  username: app.signUpUsername,
                  uid: user.uid
                })

                firebase.database().ref('/user/' + user.uid).once('value').then(function(snapshot) {
                  if (!snapshot.val()) {
                    firebase.database().ref("/user/" + user.uid).set({
                      displayName: app.signUpUsername,
                      email: user.email,
                      createdDate: firebase.database.ServerValue.TIMESTAMP,
                      recieveUpdates: app.signUpChecked,
                      usernameUnique: true
                    })
                  }
                });

              }).catch(function(error) {
                // Handle EMAIL Errors here.
                var errorCode = error.code;
                var errorMessage = error.message;
                if (error.code === 'auth/email-already-in-use') {
                  app.emailValid = "TAKEN"
                  app.signUpButtonState = "auth/invalid-email"
                } else if (error.code === 'auth/invalid-email') {
                  app.emailValid = "NOTEMAIL"
                  app.signUpButtonState = "NORMAL"
                } else if (error.code === 'auth/weak-password') {
                  app.passwordValid = "WEAK"
                  app.signUpButtonState = "NORMAL"
                }

              });
          }
        });
      }
    }

    function resetPassword(){
      app.resetButtonState = "LOADING"
      firebase.auth().sendPasswordResetEmail(app.resetEmail).then(function() {
        app.loginSignUpView = "RESETPASSWORDSUCCESS"
        clearLoginSignupModal();
      }, function(error) {
        app.loginSignUpView = "RESETPASSWORDSUCCESS"
        clearLoginSignupModal();
      })
    }

    function handleLogin(userName, uid) {
      app.userNameForMenu = userName
      app.userProjectsLink  = "./user.html#" + uid
      app.loginState = "LOGGEDIN"
    }

    function handleLogout() {
      app.loginState = "LOGGEDOUT"
      myCode = false
      clearLoginSignupModal()
    }

    var authChanged = false
    firebase.auth().onAuthStateChanged(function(user) {
      if (!authChanged){
        authChanged = true
        if (user){
          ga('set', 'userId', user.uid);
        }
      }      
      
      // if user is logging in
      if (user){
        // get and set editor theme
        firebase.database().ref('/user/' + user.uid + '/theme').once('value').then(function(snapshot) {
          if (snapshot.val()) {
            app.selectedTheme = snapshot.val();
            editor.setOption("theme", snapshot.val());
          }
        })
        
        if (user.displayName){
          handleLogin(user.displayName, user.uid)

          var ref = firebase.database().ref("user");
          ref.child(user.uid).once('value', function(snapshot) {
            if (!snapshot.val().usernameUnique){
              app.migrateUsername = ''
              $('#migrateModal').modal('show')
            }
          });
        } else if (app.signUpUsername){
          handleLogin(app.signUpUsername, user.uid)
        }

        // this puts the user's most recent project under their name
        firebase.database().ref('/code/').orderByChild("--uid").equalTo(user.uid).once('value').then(function(snapshot) {
          if (snapshot.val()){
            app.projects = []
            for (var key in snapshot.val()) {
              var project = snapshot.val()[key]
              var versions = Object.keys(project)
              var t = project[versions[versions.length-1]].time
              app.projects.push({key: key, time: t, code: project.code})
            }
          }
          // sort the proejcts by most recently touched
          app.projects.sort(function(a,b) {
            if (a.time < b.time)
              return 1;
            if (a.time > b.time)
              return -1;
            return 0;
          })
        });
      } else {
        handleLogout()
      }
    });
    
    var makeClean = function() {
      app.status = "SAVED"
      currentHash = window.location.hash
    }

    var makeDirty = function() {
      app.status = "DIRTY"
    }

    var popout = function() {
      if (app.status == "SAVED"){
        window.open("./full.html#" + getIDWithRevision(), "_blank")
      } else {
        alert("You must save your project to open it in a new window.")
      }
    }

    // set the text in the editor
    var editorVal = "setBackdropURL('./images/outerspace.jpg')\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n"
    if (getID() != ''){
      editorVal = "// Loading..."
      firebase.database().ref('/code/' + getID()).once('value').then(function(snapshot) {
        if (snapshot.val()){
          myCode = firebase.auth().currentUser && snapshot.val()["--uid"] == firebase.auth().currentUser.uid
          editor.setValue(getCurrentRevisionCode(snapshot.val()))
          makeClean()
        } else {
          alert("Could not find a project with the name: " + getID())
          editor.setValue("")
        }
      });
    }

    // we add the project name to the hash on save
    // this code prevents that from triggering a page reload
    window.addEventListener("hashchange", function() {
      if (currentHash != window.location.hash) {
        window.location.reload()
      }
    })

    var saveProject = function(name){
      firebase.database().ref('/code/' + name).limitToLast(1).once('value').then(function(snapshot) {
        if (snapshot.val()){
          if (firebase.auth().currentUser && snapshot.val()[Object.keys(snapshot.val())[0]].uid == firebase.auth().currentUser.uid) {
            // if the project exists and you own it, push the new code as a revision
            $('#saveModal').modal('hide');
            app.projectNameRequest = "NOT LOADING"
            firebase.database().ref().child("/code/" + name).push({
              code: editor.getValue(),
              time: firebase.database.ServerValue.TIMESTAMP,
              uid: firebase.auth().currentUser && firebase.auth().currentUser.uid
            }).then(function(){
              window.location.hash = name
              makeClean()
            }).catch(function(error){
              alert("Unable to save project: " + error)
            });
          } else {
            app.projectNameRequest = "NAME TAKEN"
          }
        } else {
          $('#saveModal').modal('hide');
          app.projectNameRequest = "NOT LOADING"
          firebase.database().ref().child("/code/" + name + "/--uid").set(firebase.auth().currentUser && firebase.auth().currentUser.uid)
          firebase.database().ref().child("/code/" + name).push({
            code: editor.getValue(),
            time: firebase.database.ServerValue.TIMESTAMP,
            uid: firebase.auth().currentUser && firebase.auth().currentUser.uid
          }).then(function(){
            window.location.hash = name
            myCode = firebase.auth().currentUser
            makeClean()
          }).catch(function(error){
            alert("Unable to save project: " + error)
          });
        }
      });
    }

    var save = function(){
      if (app.status == "SAVED") { return }

      if (editor.getValue().startsWith("// Loading...")){
        return // don't allow students to save projects that haven't loaded
      }

      if (myCode && getID()) {
        saveProject(getID())
      } else {
        if (getID()) {
          app.projectNameInputValue = autoIncrimentedName()
        }
        $('#saveModal').modal('show')
      }
    }

    $('.modal').on('shown.bs.modal', function () {
      $('#projectName').focus() // focus on the project name input box when the modal loads
    })

    var autoIncrimentedName = function() {
      var projName = getID();
      var versionNumber = parseInt(projName[projName.length-1])
      if (!isNaN(versionNumber) && projName[projName.length-2] == "-"){
        versionNumber += 1;
        return projName.substring(0, projName.length-1) + versionNumber.toString();
      } else {
        return projName + "-1";
      }
    }

    // keyboard shortcuts
    var mac = CodeMirror.keyMap["default"] == CodeMirror.keyMap.macDefault;
    var ctrl = mac ? "Cmd-" : "Ctrl-";
    var keymap = {}
    keymap[ctrl + "B"] = function(cm) {
      var beautiful = js_beautify(cm.getSelection(), {space_after_anon_function: true, indent_size: 2, indent_with_tabs: false })
      cm.replaceSelection(beautiful)
    }
    keymap.Tab = function(cm) {
      var spaces = Array(cm.getOption("indentUnit") + 1).join(" ");
      cm.replaceSelection(spaces, "end", "+input");
    }

    var editor = CodeMirror(document.getElementById('code'), {
        mode:  "javascript",
        value: editorVal,
        lineNumbers: true,
        lineWrapping: false,
        tabSize: 2,
        indentUnit: 2,
        indentWithTabs: false,
        electricChars: true,
        keyMap: "sublime",
        autoCloseBrackets: true,
        matchBrackets: true,
        autofocus: true,
        smartIndent: true,
        foldGutter: true,
        gutters: ["CodeMirror-lint-markers", "CodeMirror-foldgutter"],
        extraKeys: keymap,
        lint: {
          delay: 800,
          options: {
            "esnext": true,
            "asi": true
          }
        },
    });
    onkeydown = function(e){
      if(e.ctrlKey && e.key == '/'){
        e.preventDefault();
      }
      if((e.metaKey || e.ctrlKey) && e.keyCode == 'S'.charCodeAt(0)){
        e.preventDefault();
        save();
      }
    }

    function WoofJSLint(){
      if (app.error) { return }
      const code = js_beautify(app.code, {space_after_anon_function: true, indent_size: 2, indent_with_tabs: false})
      const regEx = /  ((\w)*\.)?(ready|onKeyDown|onKeyUp|onMouseDown|onMouseUp|onMouseMove|forever|repeatUntil)/g   // matches any event indented with two spaces
      var result;
      while ((result = regEx.exec(code)) !== null) {
        var lineNumber = code.substring(0, result.index).split('\n').length
        CodeMirror.commands.markGutter(editor, "warning", lineNumber, "It's usually a bad idea to have " + result[3] + "'s inside loops and other events.")
      }
    }

    function autoRunClicked(){
      if (!app.autoRunChecked){
        makeDirty()
        debouncedRunCode()
        setTimeout(function() {WoofJSLint()}, 1000); 
      }
    }

    // run the code (debounced) on every change to the editor 
    editor.on("change", function(){
      if (app.autoRunChecked){
        makeDirty()
        debouncedRunCode()
        setTimeout(function() {WoofJSLint()}, 1000); 
      }
    });
    runCode()

    // focus on the preview when refreshed
     function focusPreview() {
       document.getElementById('preview').focus();
     };

    editor.on('inputRead', function(cm, e){
      if (e.text.length == 1 && e.text[0].length == 1 &&  /^[a-zA-Z\.]/.test(e.text[0])) {
        // constantly show autocomplete suggestions
        CodeMirror.commands.autocomplete(editor);
      }
    });

    // warns the user when they try to close the page without saving
    window.onbeforeunload = function(e) {
       if (app.status == "DIRTY") {
         var dialogText = 'Make sure to copy and paste your work somewhere safe.';
         e.returnValue = dialogText;
         return dialogText;
       }
    };

    function tryRunningCode() {
      app.code = editor.getValue()
      app.error = undefined

      try {
        var result = Babel.transform(editor.getValue(), {
          presets: [['es2015', {'modules': false}]], // modules: false to remove strict mode
          retainLines: true
        })
        var code = result.code
        try {
          document.getElementById('preview').contentWindow.addEventListener("mousemove", function(event) {
            app.mouseX = Math.round(document.getElementById('preview').contentWindow.mouseX)
            if (app.mouseX >= Math.round(document.getElementById('preview').contentWindow.maxX - 2)) {
              app.mouseX += " (maxX)"
            }
            if (app.mouseX <= Math.round(document.getElementById('preview').contentWindow.minX + 1)) {
              app.mouseX += " (minX)"
            }

            app.mouseY = Math.round(document.getElementById('preview').contentWindow.mouseY)
            if (app.mouseY >= Math.round(document.getElementById('preview').contentWindow.maxY - 1)) {
              app.mouseY += " (maxY)"
            }
            if (app.mouseY <= Math.round(document.getElementById('preview').contentWindow.minY + 3)) {
              app.mouseY += " (minY)"
            }
          })
          document.getElementById('preview').contentWindow.addEventListener("error", function(event) {
            var error = event.error
            app.seenError = false
            if (error.type == "ImageLoadError") {
              app.error = {message: "There is a problem with your image URL: " + error.url, lineno: code.substring(0, code.indexOf(error.url)).split('\n').length}
            } else {
              app.error = event
            }

          });
          var script = document.createElement("script");
          script.type = "text/javascript";
          script.crossorigin = "anonymous"
          script.text = code
          document.getElementById('preview').contentDocument.body.appendChild(script)
        }
        catch (e) {
          app.seenError = false
          app.error = e;
        }
      }
      catch (e) {
        app.seenError = false
        app.error = e
      }
    }

    function runCode() {
        var iframe = document.getElementById('preview');

        iframe.src = ""; // first, we clear the preview iframe
        setTimeout(function() {

            // add doctype to iframe
            iframe.contentWindow.document.open();
            iframe.contentWindow.document.write('<!DOCTYPE html>');
            iframe.contentWindow.document.close();

            // add a base tag to the page so it knows where to pull relative image urls
            var base = iframe.contentWindow.document.createElement("base");
            base.href = document.baseURI
            iframe.contentWindow.document.body.appendChild(base);

            // then we create a script tag with the woof code and add it to the page
            var script = iframe.contentWindow.document.createElement("script");
            script.type = "text/javascript";
            script.src = "./dist/woof.js";
            iframe.contentWindow.document.body.appendChild(script);

            script.onload = function() {
                // when the woof.js library loads, run the user's code
                var evt = document.createEvent('Event');
                evt.initEvent('load', false, false);
                iframe.contentWindow.dispatchEvent(evt);
                tryRunningCode();
            }
        }, 10)
    }

    function debounce(func, wait, immediate) {
      var timeout;
      return function() {
        var context = this, args = arguments;
        var later = function() {
          timeout = null;
          if (!immediate) func.apply(context, args);
        };
        var callNow = immediate && !timeout;
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
        if (callNow) func.apply(context, args);
      };
    };
    // helper function to prevent runCode from running too often
    var debouncedRunCode = debounce(runCode, 1000, false)

  </script>
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-82374072-1', 'auto');
    ga('send', 'pageview');

  </script>
<script type="text/javascript">
    window._chatlio = window._chatlio||[];
    !function(){ var t=document.getElementById("chatlio-widget-embed");if(t&&window.ChatlioReact&&_chatlio.init)return void _chatlio.init(t,ChatlioReact);for(var e=function(t){return function(){_chatlio.push([t].concat(arguments)) }},i=["configure","identify","track","show","hide","isShown","isOnline"],a=0;a<i.length;a++)_chatlio[i[a]]||(_chatlio[i[a]]=e(i[a]));var n=document.createElement("script"),c=document.getElementsByTagName("script")[0];n.id="chatlio-widget-embed",n.src="https://w.chatlio.com/w.chatlio-widget.js",n.async=!0,n.setAttribute("data-embed-version","2.1");
       n.setAttribute('data-widget-id','1d14bee6-57d0-40e3-4768-8cc33e8abf47');
       c.parentNode.insertBefore(n,c);
    }();
</script>
</body>
</html>
